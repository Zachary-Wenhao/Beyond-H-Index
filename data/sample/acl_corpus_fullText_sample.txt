'thread disentanglement is the task of separating out conversations whose thread structure is implicit, distorted, or lost. in this paper, we perform email thread disentanglement through pairwise classification, using text similarity measures on non-quoted texts in emails. we show that i) content text similarity metrics outperform style and structure text similarity metrics in both a class-balanced and class-imbalanced setting, and ii) although feature performance is dependent on the semantic similarity of the corpus, content features are still effective even when controlling for semantic similarity. we make available the enron threads corpus, a newly-extracted corpus of 70,178 multiemail threads with emails from the enron email corpus. introduction law enforcement agencies frequently obtain large amounts of electronic messages, such as emails, which they must search for evidence. however, individual messages may be useless without the conversational context they occur in. most modern emails contain useful metadata such as the mime header in-reply-to, which marks relations between emails in a thread and can be used to disentangle threads. however, there are easy methods of obfuscating email threads: opening an email account for a single purpose; using multiple email accounts for one person; sharing one email account among multiple persons; changing the subject header; and removing quoted material from earlier in the thread. how can emails be organized by thread without metadata such as their mime headers? we propose to use text similarity metrics to identify emails belonging to the same thread. in this paper, as a first step for temporal thread disentanglement, we perform pairwise classification experiments on texts in emails using no mime headers or quoted previous emails. we have found that content-based text similarity metrics outperform a dice baseline, and that structural and style text similarity features do not; adding these latter feature groups does not significantly improve total performance. we also found that contentbased features continue to outperform the others in both a class-balanced and class-imbalanced setting, as well as with semantically controlled or non-controlled negative instances. in nlp, elsner and charniak (2010) described the task of thread disentanglement as "the clustering task of dividing a transcript into a set of distinct conversations," in which extrinsic thread delimitation is unavailable and the threads must be disentangled using only intrinsic information. in addition to emails with missing or incorrect mime headers, entangled electronic conversations occur in environments such as interspersed internet relay chat conversations, web 2.0 article response conversations that do not have a hierarchical display order, and misplaced comments in wiki talk discussions. research on disentanglement of conversation threads has been done on internet relay chats (elsner and charniak, 2010) , audio chats (aoki et al., 2003) , and emails with headers and quoted material (yeh, 2006; erera and carmel, 2008) . however, to the best of our knowledge, no work has investigated reassembling email threads without the help of mime headers or quoted previous emails. previous researchers have used a number of email corpora with high-precision (non-subject-clustered) thread marking. joti et al. (2010) used the bc3 corpus of 40 email threads and 3222 emails for topic segmentation. carenini et al. (2008) annotated 39 email "conversations" from the enron email corpus for email summariation. wan and mckeown (2004) used a privatelyavailable corpus of 300 threads for summary generation. rambow et al. (2004) used a privatelyavailable corpus of 96 email threads for thread summarization. data the enron email corpus (eec) 1 consists of the 517,424 emails (159 users\' accounts and 19,675 total senders) that existed on the enron corporation\'s email server (i.e., other emails had been previously deleted, etc) when it was made public . gold standard thread extraction from the enron email corpus we define an email thread as a directed graph of emails connected by reply and forward relations. in this way, we attempt to identify email discussions between users. however, the precise definition of an email thread actually depends on the implementation that we, or any other researchers, used to identify the thread. previous researchers have derived email thread structure from a variety of sources. wu and oard (2005) , and zhu et al. (2005) auto-threaded all messages with identical, non-trivial, fwd: and re:-stripped subject headers. klimt and yang (2004) auto-threaded messages that had stripped subject headers and were among the same users (addresses). lewis and knowles (1997) assigned emails to threads by matching quotation structures between emails. wan and mckeown (2004) reconstructed threads by header message-id information. rambow et al. (2004) used a privately-available corpus of 96 email threads, but did not specify how they determined the threads. as the emails in the eec do not contain any inherent thread structure, it was necessary for us to create email threads. first, we implemented klimt and yang (2004) \'s technique of clustering the emails into threads that have the same subject header (after it has been stripped of pre-fixes such as re: and fwd:) and shared participants. to determine whether emails were among the same users, we split a subject-created email proto-thread apart into any necessary threads, such that the split threads had no senders or recipients (including to, cc, and bcc) in common. the resulting email clusters had a number of problems. clusters tended to over-group, because a single user included as a recipient for two different threads with the subject "monday meeting" would cause the threads to be merged into a single cluster. in addition, many clusters consisted of all of the issues of a monthly subscription newsletter, or nearly identical petitions (see klimt and yang (2004) \'s description of the "demand ken lay donate proceeds from enron stock sales" thread), or an auto-generated log of enron computer network problems auto-emailed to the enron employees in charge of the network. such clusters of "broadcast" emails do not satisfy our goal of identifying email discussions between users. many email discussions between users exist in previously quoted emails auto-copied at the bottom of latter emails of the thread. a singleannotator hand-investigation of 465 previously quoted emails from 20 threads showed that none of them had interspersed comments or had otherwise been altered by more recent thread contributors. threads in the eec are quoted multiple times at various points in the conversation in multiple surviving emails. in order to avoid creating redundant threads, which would be an information leak risk during evaluation, we selected as the thread source the email from each klimt and yang (2004) cluster with the most quoted emails, and discarded all other emails in the cluster. we used the quoteidentifying regular expressions from yeh (2006) (see table 1 ) to identify quoted previous emails. 2  there are two important benefits to the creation methodology of the enron threads corpus 3 . first, since the emails were extracted from the same document, and the emails would only have been included in the same document by the email client if one was a reply or forward of the other, precision is very high (approaching 100%). 4 this is  better precision than threads clustered from separate email documents, which may have the same subject, etc. generating false positives. some emails will inevitably be left out of the thread, reducing recall, because they were not part of the thread branch that was eventually used to represent the thread, or simply because they were not quoted. our pairwise classification experiments, described in section 4, are unaffected by this reduced recall, because each experimental instance includes only a pair of emails, and not the entire thread. second, because the thread source did not require human annotation, using quoted emails gives us an unprecedented number of threads as data: 209,063 emails in 70,178 threads of two emails or larger. the sizes of email threads in the enron threads corpus is shown in table 2 . emails have an average of 80.0±201.2 tokens, and an average count of 4.4±9.3 sentences. many of the emails are quite short: 18% are under 10 tokens, 19% are 10-20 tokens, and 13% are 20-30 tokens. text similarity features we cast email thread disentanglement as a text similarity problem. ideally, there exists a text similarity measure that marks pairs of emails from the system misidentified about 1% of emails from regular expression error. same thread as more similar than pairs of emails from different threads. we evaluate a number of text similarity measures, divided according to bär et al. (2011) \'s three groups: content similarity, structural similarity, style similarity. each set of features investigates a different manner in which email pairs from the same thread may be identified. in our experiments, all features are derived from the body of the email, while all headers such as recipients, subject, and timestamp are ignored. content features. content similarity metrics capture the string overlap between emails with similar content. a pair of emails with a high content overlap is shown below. the longest common substring measure (gusfield, 1997) identifies uninterrupted common strings, while the longest common subsequence measure (allison and dix, 1986 ) and the singletext-length-normalized longest common subsequence norm measure identify common strings containing interruptions and text replacements and greedy string tiling measure (wise, 1996) allows reordering of the subsequences. other measures which treat texts as sequences of characters and compute similarities with various metrics include levenshtein (1966) , monge elkan second string measure (monge and elkan, 1997) , jaro second string measure (jaro, 1989) , and jaro winkler second string measure (winkler, 1990) . a cosine similarity-type measure was used, based on term frequency within the document. sets of ngrams from the two emails are compared using the jaccard coefficient (from lyon et al. (2004) ) and broder\'s (1997) containment measure. structural features. structural features attempt to identify similar syntactic patterns between the two texts, while overlooking topicspecific vocabulary. we propose that sturctural features, as well as style features below, may help in classification by means of communication accommodation theory (giles and ogay, 2007 ). stamatatos\'s stopword n-grams (2011) capture syntactic similarities, by identifying text reuse where just the content words have been replaced and the stopwords remain the same. we measured the stopword n-gram overlap with broder\'s (1997) containment measure and four different stopword lists. we also tried the containment measure and an ngram jaccard measure with part-of-speech tags. token pair order (hatzivassiloglou et al. 1999 ) uses pairs of words occurring in the same order for the two emails; token pair distance (hatzivassiloglou et al., 1999) measures the distance between pairs of words. both measures use computed feature vectors for both emails along all shared word pairs, and the vectors are compared with pearson correlation. style features. style similarity reflects authorship attribution and surface-level statistical properties of texts. type token ratio (ttr) measure calculates text-length-sensitive and text-homogeneitysensitive vocabulary richness (templin, 1957) . however, as this measure is sensitive to differences in document length between the pair of documents (documents become less lexically diverse as length and token count increases but type count levels off), and fluctuating lexical diversity as rhetorical strategies shift within a single document, we also used sequential ttr (mccarthy and jarvis, 2010), which corrects for these problems. sentence length and token length (inspired by (yule, 1939) ) measure the average number of tokens per sentence and characters per token, respectively. sentence ratio and token ratio compare sentence length and token length between the two emails (bär et al., 2011) . function word frequencies is a pearson\'s correlation between feature vectors of the frequencies of 70 pre-identified function words from mosteller and wallace (1964) across the two emails. we also compute case combined ratio, showing the percentage of uppercase characters in both emails combined ( u p p ercase e1 +u p p ercase e2 allchars e1 +allchars e2 ), and case document similarity, showing the similarity between the percentage of uppercase characters in one email versus the other email. evaluation in this series of experiments, we evaluate the effectiveness of different feature groups to classify pairs of emails as being from the same thread (positive) or not (negative). each instance to be classified is represented by the features from a pair of emails and the instance classification, positive or negative. we used a variation of k-fold cross-validation for evaluation. the 10 folds contained carefully distributed email pairs such that email pairs with emails from the same thread were never used in pairs of training, development, and testing sets, to avoid information leakage. all instances were at one point in a test set. instance division was roughly 80% training, 10% development, and 10% test data. reported results are the weighted averages across all folds. the evaluation used logistic regression, as implemented in weka (hall et al., 2009) . default parameters were used. we use a baseline algorithm of dice similarity between the texts of the two emails as a simple measure of set similarity. we created an upper bound by annotating 100 positive and 100 negative instances. a single native english speaker annotator answered the question, "are these emails from the same thread?" data sampling although we had 413,814 positive instances available in the enron threads corpus, we found that classifier performance was unaffected by the amount of training data, down to very low levels (see figure 1 ). however, because the standard deviation in the data did not level out until around 1,200 class-balanced training instances 5 , we used this number of positive instances (600) in each of our experiments. in order to estimate effectiveness of features for different data distributions, we used three different subsampled datasets. random balanced (rb) dataset. the first dataset is class-balanced and uses 1200 training instances. minimum email length is one word. for every positive instance we used, we created a negative email pair by taking the first email from the positive pair and pseudo-randomly pairing it with another email from a different thread that was assigned to the same training, development, or test set. however, the probability of semantic similarity between two emails in a positive instance is much greater than the probability of semantic similarity between two emails in a randomly-created negative instance. the results of experiments on our first dataset reflect both the success of our text similarity metrics and the semantic similarity (i.e., topical distribution) within our dataset. the topical distribution will vary immensely between different email corpora. to investigate the performance of our features in a more generaliable environment, we created a subsample dataset that con- trolls for semantic similarity within and outside of the email thread. semantically balanced (sb) dataset. the second dataset combines the same positive instances as the first set with an equal number of semantically-matched negative instances for a training size of 1200 instances, and a minimum email length of one word. for each positive instance, we measured the semantic similarity within the email pair using cosine similarity and then created a negative instance with the same (±.005) similarity. emails had an average of 96±287 tokens and 5±11sentences, and a similar token size distribution as sb. random imbalanced (ri) dataset. however, both the rb and sb datasets use a class-balanced distribution. to see if our features are still effective in a class-imbalanced environment, we created a third dataset with a 90% negative, 10% positive distribution for both the training and test sets 6 . specifically, we used the first dataset and then added an extra 8 negative instances for each positive instance. experiments with this dataset use 10-fold cross validation, where each fold has 6000 training and 750 test instances. no minimum email length was used, similar to a more natural distribution. results our results are shown in table 3 . since we aim to detect pairs of emails belonging to the same thread rather than unrelated emails, we measure the system performance on the positive class. we use the standard f-measure of f 1 = 2×p (pos)×r(pos) p (pos)+r(pos) . as a measure to show performance on both positive and negative classes, we provide a standard accuracy measure of acc= t p +t n t p +f n +t n +f p . feature groups are shown in isolation as well as the complete set of features minus one group. 7  with the rb corpus, the best performing single feature configuration, content features group (p=.83 ±.04), matches the human upper bound precision(p=.84). the benefit of content features is confirmed by the reductions in complete feature set performance when they are left out. the content features group was the only group to perform significantly above the dice baseline. adding the other feature groups does not significantly improve the overall results. further leave-one-out experiments revealed no single high performing feature within the content features group. structural features produced low performance, failing to beat the chance baseline. structural similarity from rhetorical strategy is rare in an email conversational setting. any structural benefits are likely to come from sources unavailable in a disguised email situation, such as auto-signatures identifying senders as the same person. the low results on structural features show that we are not relying on such artifacts for classification. style features were also unhelpful, failing to significantly beat the dice baseline. the features failed to identify communication accomodation within the thread. results on the sb dataset show that there is a noticeable drop in classification for all feature groups when negative instances have a similar semantic similarity as positive instances. the configuration with all features showed a 15 percentage point drop in precision, and a 12 percentage point drop in accuracy. however, content features continues to be the best performing feature group with semantically similar negative instances, as with random negative instances, and outperformed the dice baseline. adding the additional feature groups does not significantly improve overall performance. the results on the ri corpus mirror results from the balanced (rb) corpus. 2011 ) use coherence models to disentangle chat, using some features (entity grid, topical entity grid) which correspond to the information in our content features group. they also found these content-based features to be helpful. inherent limitations certain limitations are inherent in email thread disentanglement. some email thread relations cannot be detected with text similarity metrics, and require extensive discourse knowledge, such as the emails below. email1: can you attend the directors fund equity board meeting next wednesday, nov 5, at 3pm? email2: yes, i will be there. several other problems in email thread disentanglement cannot be solved with any discourse knowledge. one problem is that some emails are identical or near-identical; there is no way to choose between textually identical emails. table 4 shows some of the most common email texts in our corpus, based on a <.05 similarity value from jaro second string similarity, as described in section 3. however, near identical texts make up only a small portion of the emails in our corpus. in a sample of 5,296 emails, only 3.6% of email texts were within a .05 jaro second string similarity value of another text. another problem is that some emails are impossible to distinguish without world and domain knowledge. consider a building with two meeting rooms: a101 and a201. sometimes a101 is used, and sometimes a201 is used. in response to the question, which room is monday\'s meeting in?, there may be no way to choose between a101 and a201 without further world knowledge. another problem is topic overlap. for example, in a business email corpus such as the eec, there are numerous threads discussing monday morning 9am meetings. the more similar the language used between threads, the more difficult the disentanglement becomes, using text similarity. this issue is addressed with the sb dataset. finally, our classifier cannot out-perform humans on the same task, so it is important to note human limitations in email disentanglement. our human upper bound is shown in table 3 . we will further address this issue in sections 4.4. error analysis we inspected 50 email pairs each of true positives, false positives, false negatives, and true negatives from our rb experiments 8 . we inspected for both technical details likely to affect classification, and for linguistic features to guide future research. technical details included small and large text errors (such as unidentified email headers or incorrect email segmentation), custom and noncustom email signatures, and the presense of large signatures likely to affect classification. linguistic features included an appearance of consecutivity (emails appear in a q/a relation, or one is informative and one is \'please print\', etc.), similarity of social style ("language vocab level, professionalism, and social address are a reasonable match"), and the annotator\'s perception that the emails could be from the same thread. an example of a text error is shown below. names and dates occur frequently in legitimate email text, such as meeting attendance lists, etc., which makes them difficult to screen out. emails from false positives were less likely to contain these small errors (3% versus 14%), which implies that the noise introduced from the extra text has more impact than the false similarity potentially generated by similar text errors. large text errors (such as 2 emails labelled as one) occurred in only 1% of emails and were too rare to correlate with results. autosignatures, such as the examples below, mildly impacted classification. instances classified as negative (both fn and tn) were marginally more likely to have had one email with a non-customized autosignature (3% versus 1.5%) or a customized auto-signature (6.5% versus 3.5%). autosignatures were also judged likely to affect similarity values more often on instances classified as negative (20% of instances). the presence of the autosignature may have introduced enough noise for the classifier to decide the emails were not similar enough to be from the same thread. we define a non-custom auto-signature as any automatically-added text at the bottom of the email. we did not see enough instances where both emails had an autosignature to evaluate whether similarities in autosignatures (such as a common area code) impacted results. some email pair similarities, observable by humans, are not being captured by our text similarity features. nearly all (98%) positive instances were recognized by the annotator as potential consecutive emails within a thread, or non-consecutive emails but still from the same thread, whereas only 46% of negative instances were similarly (falsely) noted. only 2% of negative instances were judged to look like they were consecutive emails within the same thread. the following tp instance shows emails that look like they could be from the same thread but do not look consecutive. below is a tn instance with emails that look like they could be from the same thread but do not look consecutive. email1: i do but i havent heard from you either, how are things with wade email2: rumor has it that a press conference will take place at 4:00 -more money in, lower conversion rate. the level of professionalism ("language vocab level, professionalism, and social address are a reasonable match") was also notable between class categories. all tp instances were judged to have a professionalism match, as well as 94% of fn\'s. however, only 64% of fp\'s and 56% of tn\'s were judged to have a professionalism match. based on a review of our misclassified instances, we are surprised that our classifier did not learn a better model based on style features (f 1 =.60). participants in an email thread appear to echo the style of emails they reply to. for instance, short, casual, all-lowercase emails are frequently responded to in a similar manner. conclusion in this paper, we have described the creation of the enron threads corpus, which we made available online. we have investigated the use of text similarity features for the pairwise classification of emails for thread disentanglement. we have found that content similarity features are more effective than style or structural features across class-balanced and class-imbalanced environments. there appear to be more stylistic features uncaptured by our similarity metrics, which humans access for performing the same task. we have shown that semantic differences between corpora will impact the general effectiveness of text similarity features, but that content features remain effective. in future work, we will investigate discourse knowledge, highly-tuned stylistic features, and other email-specific features to improve headerless, quoteless email thread disentanglement. acknowledgments this work has been supported by the volkswagen foundation as part of the lichtenberg-professorship program under grant no. i/82806, and by the center for advanced security research (www.cased.de).'